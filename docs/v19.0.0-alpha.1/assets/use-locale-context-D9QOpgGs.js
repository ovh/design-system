import{f as I,h as K,j as Q,k as X,l as M,w as F,t as Y,n as Z,o as U}from"./index-DDDhx9B2.js";import{r as f}from"./index-D_CmzhJ4.js";import{r as q}from"./index-ChzAxGiP.js";import"./jsx-runtime-VM66peLj.js";function h(t){return new Proxy({},{get(o,c){return c==="style"?u=>t({style:u}).style:t}})}var ft=()=>t=>Array.from(new Set(t)),W=typeof globalThis.document<"u"?f.useLayoutEffect:f.useEffect;function J(t){const o=t().value??t().defaultValue,c=t().isEqual??Object.is,[u]=f.useState(o),[l,x]=f.useState(u),m=t().value!==void 0,E=f.useRef(l);E.current=m?t().value:l;const C=f.useRef(E.current);W(()=>{C.current=E.current},[l,t().value]);const _=v=>{var N,w;const i=C.current,d=M(v)?v(i):v;t().debug&&console.log(`[bindable > ${t().debug}] setValue`,{next:d,prev:i}),m||x(d),c(d,i)||(w=(N=t()).onChange)==null||w.call(N,d,i)};function L(){return m?t().value:l}return{initial:u,ref:E,get:L,set(v){(t().sync?q.flushSync:X)(()=>_(v))},invoke(v,i){var d,N;(N=(d=t()).onChange)==null||N.call(d,v,i)},hash(v){var i,d;return((d=(i=t()).hash)==null?void 0:d.call(i,v))??String(v)}}}function tt(t){const o=f.useRef(t);return{get(c){return o.current[c]},set(c,u){o.current[c]=u}}}var et=(t,o)=>{const c=f.useRef(!1),u=f.useRef(!1);f.useEffect(()=>{if(c.current&&u.current)return o();u.current=!0},[...(t??[]).map(l=>typeof l=="function"?l():l)]),f.useEffect(()=>(c.current=!0,()=>{c.current=!1}),[])};function at(t,o={}){var T,$,A,D;const c=f.useMemo(()=>{const{id:n,ids:e,getRootNode:r}=o;return I({id:n,ids:e,getRootNode:r})},[o]),u=(...n)=>{t.debug&&console.log(...n)},l=((T=t.props)==null?void 0:T.call(t,{props:K(o),scope:c}))??o,x=nt(l),m=($=t.context)==null?void 0:$.call(t,{prop:x,bindable:J,scope:c,flush:B,getContext(){return C},getComputed(){return V}}),E=G(m),C={get(n){var e;return(e=E.current)==null?void 0:e[n].ref.current},set(n,e){var r;(r=E.current)==null||r[n].set(e)},initial(n){var e;return(e=E.current)==null?void 0:e[n].initial},hash(n){var r,s;const e=(r=E.current)==null?void 0:r[n].get();return(s=E.current)==null?void 0:s[n].hash(e)}},_=f.useRef(new Map),L=f.useRef(null),v=f.useRef(null),i=f.useRef({type:""}),d=()=>({...i.current,current(){return i.current},previous(){return v.current}}),N=()=>({...R,matches(...n){return n.includes(R.ref.current)},hasTag(n){var e,r;return!!((r=(e=t.states[R.ref.current])==null?void 0:e.tags)!=null&&r.includes(n))}}),w=tt(((A=t.refs)==null?void 0:A.call(t,{prop:x,context:C}))??{}),S=()=>({state:N(),context:C,event:d(),prop:x,send:O,action:b,guard:j,track:et,refs:w,computed:V,flush:B,scope:c,choose:P}),b=n=>{const e=M(n)?n(S()):n;if(!e)return;const r=e.map(s=>{var g,y;const a=(y=(g=t.implementations)==null?void 0:g.actions)==null?void 0:y[s];return a||F(`[zag-js] No implementation found for action "${JSON.stringify(s)}"`),a});for(const s of r)s==null||s(S())},j=n=>{var e,r;return M(n)?n(S()):(r=(e=t.implementations)==null?void 0:e.guards)==null?void 0:r[n](S())},k=n=>{const e=M(n)?n(S()):n;if(!e)return;const r=e.map(a=>{var y,p;const g=(p=(y=t.implementations)==null?void 0:y.effects)==null?void 0:p[a];return g||F(`[zag-js] No implementation found for effect "${JSON.stringify(a)}"`),g}),s=[];for(const a of r){const g=a==null?void 0:a(S());g&&s.push(g)}return()=>s.forEach(a=>a==null?void 0:a())},P=n=>Y(n).find(e=>{let r=!e.guard;return Z(e.guard)?r=!!j(e.guard):M(e.guard)&&(r=e.guard(S())),r}),V=n=>{Q(t.computed,"[zag-js] No computed object found on machine");const e=t.computed[n];return e({context:C,event:d(),prop:x,refs:w,scope:c,computed:V})},R=J(()=>({defaultValue:t.initialState({prop:x}),onChange(n,e){var s,a,g,y;if(e){const p=_.current.get(e);p==null||p(),_.current.delete(e)}e&&b((s=t.states[e])==null?void 0:s.exit),b((a=L.current)==null?void 0:a.actions);const r=k((g=t.states[n])==null?void 0:g.effects);if(r&&_.current.set(n,r),e==="__init__"){b(t.entry);const p=k(t.effects);p&&_.current.set("__init__",p)}b((y=t.states[n])==null?void 0:y.entry)}})),z=f.useRef(void 0);W(()=>{queueMicrotask(()=>{const e=z.current??R.initial;R.invoke(e,"__init__")});const n=_.current;return()=>{z.current=R.ref.current,n.forEach(e=>e==null?void 0:e()),_.current=new Map,L.current=null,queueMicrotask(()=>{b(t.exit)})}},[]);const H=()=>"ref"in R?R.ref.current:R.get(),O=n=>{queueMicrotask(()=>{var y,p;v.current=i.current,i.current=n,u("send",n);let e=H();const r=((y=t.states[e].on)==null?void 0:y[n.type])??((p=t.on)==null?void 0:p[n.type]),s=P(r);if(!s)return;L.current=s;const a=s.target??e;u("transition",s);const g=a!==e;g?q.flushSync(()=>R.set(a)):s.reenter&&!g?R.invoke(e,e):b(s.actions??[])})};return(D=t.watch)==null||D.call(t,S()),{state:N(),send:O,context:C,prop:x,scope:c,refs:w,computed:V,event:d()}}function G(t){const o=f.useRef(t);return o.current=t,o}function nt(t){const o=G(t);return function(u){return o.current[u]}}function B(t){queueMicrotask(()=>{q.flushSync(()=>t())})}var it=h(t=>t);function lt(t,o={}){const{sync:c=!1}=o,u=rt(t);return f.useCallback((...l)=>{var x;return c?queueMicrotask(()=>{var m;return(m=u.current)==null?void 0:m.call(u,...l)}):(x=u.current)==null?void 0:x.call(u,...l)},[c,u])}function rt(t){const o=f.useRef(t);return o.current=t,o}const[dt,gt]=U({name:"EnvironmentContext",hookName:"useEnvironmentContext",providerName:"<EnvironmentProvider />",strict:!1,defaultValue:{getRootNode:()=>document,getDocument:()=>document,getWindow:()=>window}}),[vt,xt]=U({name:"LocaleContext",hookName:"useLocaleContext",providerName:"<LocaleProvider />",strict:!1,defaultValue:{dir:"ltr",locale:"en-US"}});export{at as a,gt as b,ft as c,xt as d,it as n,lt as u};
