import{r as p,b as I,g as X,e as P,f as D,h as Y,d as k,j as H,k as T,l as x,m as S,n as K,w as q,o as R,s as U}from"./index-BCxMAfLs.js";function V(t){const e={each(n){var r;for(let i=0;i<((r=t.frames)==null?void 0:r.length);i+=1){const s=t.frames[i];s&&n(s)}},addEventListener(n,r,i){return e.each(s=>{try{s.document.addEventListener(n,r,i)}catch{}}),()=>{try{e.removeEventListener(n,r,i)}catch{}}},removeEventListener(n,r,i){e.each(s=>{try{s.document.removeEventListener(n,r,i)}catch{}})}};return e}function j(t){const e=t.frameElement!=null?t.parent:null;return{addEventListener:(n,r,i)=>{try{e==null||e.addEventListener(n,r,i)}catch{}return()=>{try{e==null||e.removeEventListener(n,r,i)}catch{}}},removeEventListener:(n,r,i)=>{try{e==null||e.removeEventListener(n,r,i)}catch{}}}}var A="pointerdown.outside",C="focus.outside";function $(t){for(const e of t)if(T(e)&&Y(e))return!0;return!1}var _=t=>"clientY"in t;function z(t,e){if(!_(e)||!t)return!1;const n=t.getBoundingClientRect();return n.width===0||n.height===0?!1:n.top<=e.clientY&&e.clientY<=n.top+n.height&&n.left<=e.clientX&&e.clientX<=n.left+n.width}function G(t,e){return t.y<=e.y&&e.y<=t.y+t.height&&t.x<=e.x&&e.x<=t.x+t.width}function M(t,e){if(!e||!_(t))return!1;const n=e.scrollHeight>e.clientHeight,r=n&&t.clientX>e.offsetLeft+e.clientWidth,i=e.scrollWidth>e.clientWidth,s=i&&t.clientY>e.offsetTop+e.clientHeight,E={x:e.offsetLeft,y:e.offsetTop,width:e.clientWidth+(n?16:0),height:e.clientHeight+(i?16:0)},y={x:t.clientX,y:t.clientY};return G(E,y)?r||s:!1}function J(t,e){const{exclude:n,onFocusOutside:r,onPointerDownOutside:i,onInteractOutside:s,defer:E}=e;if(!t)return;const y=I(t),L=X(t),m=V(L),b=j(L);function w(o){const u=k(o);if(!T(u)||!u.isConnected||x(t,u)||z(t,o))return!1;const h=y.querySelector(`[aria-controls="${t.id}"]`);if(h){const v=S(h);if(M(o,v))return!1}const B=S(t);return M(o,B)?!1:!(n!=null&&n(u))}const g=new Set;function c(o){function u(){var v;const h=E?p:O=>O(),B=((v=o.composedPath)==null?void 0:v.call(o))??[o.target];h(()=>{if(!(!t||!w(o))){if(i||s){const O=D(i,s);t.addEventListener(A,O,{once:!0})}N(t,A,{bubbles:!1,cancelable:!0,detail:{originalEvent:o,contextmenu:H(o),focusable:$(B)}})}})}o.pointerType==="touch"?(g.forEach(h=>h()),g.add(P(y,"click",u,{once:!0})),g.add(b.addEventListener("click",u,{once:!0})),g.add(m.addEventListener("click",u,{once:!0}))):u()}const a=new Set,f=setTimeout(()=>{a.add(P(y,"pointerdown",c,!0)),a.add(b.addEventListener("pointerdown",c,!0)),a.add(m.addEventListener("pointerdown",c,!0))},0);function l(o){(E?p:h=>h())(()=>{if(!(!t||!w(o))){if(r||s){const h=D(r,s);t.addEventListener(C,h,{once:!0})}N(t,C,{bubbles:!1,cancelable:!0,detail:{originalEvent:o,contextmenu:!1,focusable:Y(k(o))}})}})}return a.add(P(y,"focusin",l,!0)),a.add(b.addEventListener("focusin",l,!0)),a.add(m.addEventListener("focusin",l,!0)),()=>{clearTimeout(f),g.forEach(o=>o()),a.forEach(o=>o())}}function Q(t,e){const{defer:n}=e,r=n?p:s=>s(),i=[];return i.push(r(()=>{const s=typeof t=="function"?t():t;i.push(J(s,e))})),()=>{i.forEach(s=>s==null?void 0:s())}}function N(t,e,n){const r=t.ownerDocument.defaultView||window,i=new r.CustomEvent(e,n);return t.dispatchEvent(i)}function Z(t,e){const n=r=>{r.key==="Escape"&&(r.isComposing||e==null||e(r))};return P(I(t),"keydown",n,{capture:!0})}var d={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(t=>t.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(t){var r;const e=this.indexOf(t),n=this.topMostPointerBlockingLayer()?this.indexOf((r=this.topMostPointerBlockingLayer())==null?void 0:r.node):-1;return e<n},isTopMost(t){const e=this.layers[this.count()-1];return(e==null?void 0:e.node)===t},getNestedLayers(t){return Array.from(this.layers).slice(this.indexOf(t)+1)},isInNestedLayer(t,e){return this.getNestedLayers(t).some(n=>x(n.node,e))},isInBranch(t){return Array.from(this.branches).some(e=>x(e,t))},add(t){const e=this.layers.push(t);t.node.style.setProperty("--layer-index",`${e}`)},addBranch(t){this.branches.push(t)},remove(t){const e=this.indexOf(t);e<0||(e<this.count()-1&&this.getNestedLayers(t).forEach(r=>r.dismiss()),this.layers.splice(e,1),t.style.removeProperty("--layer-index"))},removeBranch(t){const e=this.branches.indexOf(t);e>=0&&this.branches.splice(e,1)},indexOf(t){return this.layers.findIndex(e=>e.node===t)},dismiss(t){var e;(e=this.layers[this.indexOf(t)])==null||e.dismiss()},clear(){this.remove(this.layers[0].node)}},W;function F(){d.layers.forEach(({node:t})=>{t.style.pointerEvents=d.isBelowPointerBlockingLayer(t)?"none":"auto"})}function ee(t){t.style.pointerEvents=""}function te(t,e){const n=I(t),r=[];if(d.hasPointerBlockingLayer()&&!n.body.hasAttribute("data-inert")&&(W=document.body.style.pointerEvents,queueMicrotask(()=>{n.body.style.pointerEvents="none",n.body.setAttribute("data-inert","")})),e){const i=R(e,s=>{r.push(U(s,{pointerEvents:"auto"}))});r.push(i)}return()=>{d.hasPointerBlockingLayer()||(queueMicrotask(()=>{n.body.style.pointerEvents=W,n.body.removeAttribute("data-inert"),n.body.style.length===0&&n.body.removeAttribute("style")}),r.forEach(i=>i()))}}function ne(t,e){const{warnOnMissingNode:n=!0}=e;if(n&&!t){q("[@zag-js/dismissable] node is `null` or `undefined`");return}if(!t)return;const{onDismiss:r,pointerBlocking:i,exclude:s,debug:E}=e,y={dismiss:r,node:t,pointerBlocking:i};d.add(y),F();function L(c){var f,l;const a=k(c.detail.originalEvent);d.isBelowPointerBlockingLayer(t)||d.isInBranch(a)||((f=e.onPointerDownOutside)==null||f.call(e,c),(l=e.onInteractOutside)==null||l.call(e,c),!c.defaultPrevented&&(E&&console.log("onPointerDownOutside:",c.detail.originalEvent),r==null||r()))}function m(c){var f,l;const a=k(c.detail.originalEvent);d.isInBranch(a)||((f=e.onFocusOutside)==null||f.call(e,c),(l=e.onInteractOutside)==null||l.call(e,c),!c.defaultPrevented&&(E&&console.log("onFocusOutside:",c.detail.originalEvent),r==null||r()))}function b(c){var a;d.isTopMost(t)&&((a=e.onEscapeKeyDown)==null||a.call(e,c),!c.defaultPrevented&&r&&(c.preventDefault(),r()))}function w(c){var o;if(!t)return!1;const a=typeof s=="function"?s():s,f=Array.isArray(a)?a:[a],l=(o=e.persistentElements)==null?void 0:o.map(u=>u()).filter(T);return l&&f.push(...l),f.some(u=>x(u,c))||d.isInNestedLayer(t,c)}const g=[i?te(t,e.persistentElements):void 0,Z(t,b),Q(t,{exclude:w,onFocusOutside:m,onPointerDownOutside:L,defer:e.defer})];return()=>{d.remove(t),F(),ee(t),g.forEach(c=>c==null?void 0:c())}}function ie(t,e){const{defer:n}=e,r=n?p:s=>s(),i=[];return i.push(r(()=>{const s=K(t)?t():t;i.push(ne(s,e))})),()=>{i.forEach(s=>s==null?void 0:s())}}export{ie as t};
