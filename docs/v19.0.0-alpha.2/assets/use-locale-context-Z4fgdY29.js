import{C as I,D as K,E as Q,F as X,n as M,w as A,G as Y,H as Z,c as G}from"./index-BCxMAfLs.js";import{r as c}from"./index-D_CmzhJ4.js";import{r as k}from"./index-ChzAxGiP.js";import"./jsx-runtime-VM66peLj.js";function h(t){return new Proxy({},{get(a,s){return s==="style"?i=>t({style:i}).style:t}})}var ct=()=>t=>Array.from(new Set(t)),H=typeof globalThis.document<"u"?c.useLayoutEffect:c.useEffect;function J(t){const a=t().value??t().defaultValue,s=t().isEqual??Object.is,[i]=c.useState(a),[x,E]=c.useState(i),w=t().value!==void 0,y=c.useRef(x);y.current=w?t().value:x;const m=c.useRef(y.current);H(()=>{m.current=y.current},[x,t().value]);const C=g=>{var b,S;const f=m.current,l=M(g)?g(f):g;t().debug&&console.log(`[bindable > ${t().debug}] setValue`,{next:l,prev:f}),w||E(l),s(l,f)||(S=(b=t()).onChange)==null||S.call(b,l,f)};function L(){return w?t().value:x}return{initial:i,ref:y,get:L,set(g){(t().sync?k.flushSync:X)(()=>C(g))},invoke(g,f){var l,b;(b=(l=t()).onChange)==null||b.call(l,g,f)},hash(g){var f,l;return((l=(f=t()).hash)==null?void 0:l.call(f,g))??String(g)}}}function tt(t){const a=c.useRef(t);return{get(s){return a.current[s]},set(s,i){a.current[s]=i}}}var et=(t,a)=>{const s=c.useRef(!1),i=c.useRef(!1);c.useEffect(()=>{if(s.current&&i.current)return a();i.current=!0},[...(t??[]).map(x=>typeof x=="function"?x():x)]),c.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function at(t,a={}){var F,O,T,$;const s=c.useMemo(()=>{const{id:n,ids:e,getRootNode:r}=a;return I({id:n,ids:e,getRootNode:r})},[a]),i=(...n)=>{t.debug&&console.log(...n)},x=((F=t.props)==null?void 0:F.call(t,{props:K(a),scope:s}))??a,E=nt(x),w=(O=t.context)==null?void 0:O.call(t,{prop:E,bindable:J,scope:s,flush:B,getContext(){return m},getComputed(){return V}}),y=U(w),m={get(n){var e;return(e=y.current)==null?void 0:e[n].ref.current},set(n,e){var r;(r=y.current)==null||r[n].set(e)},initial(n){var e;return(e=y.current)==null?void 0:e[n].initial},hash(n){var r,o;const e=(r=y.current)==null?void 0:r[n].get();return(o=y.current)==null?void 0:o[n].hash(e)}},C=c.useRef(new Map),L=c.useRef(null),g=c.useRef(null),f=c.useRef({type:""}),l=()=>({...f.current,current(){return f.current},previous(){return g.current}}),b=()=>({...R,matches(...n){return n.includes(R.ref.current)},hasTag(n){var e,r;return!!((r=(e=t.states[R.ref.current])==null?void 0:e.tags)!=null&&r.includes(n))}}),S=tt(((T=t.refs)==null?void 0:T.call(t,{prop:E,context:m}))??{}),_=()=>({state:b(),context:m,event:l(),prop:E,send:D,action:N,guard:q,track:et,refs:S,computed:V,flush:B,scope:s,choose:j}),N=n=>{const e=M(n)?n(_()):n;if(!e)return;const r=e.map(o=>{var d,p;const u=(p=(d=t.implementations)==null?void 0:d.actions)==null?void 0:p[o];return u||A(`[zag-js] No implementation found for action "${JSON.stringify(o)}"`),u});for(const o of r)o==null||o(_())},q=n=>{var e,r;return M(n)?n(_()):(r=(e=t.implementations)==null?void 0:e.guards)==null?void 0:r[n](_())},P=n=>{const e=M(n)?n(_()):n;if(!e)return;const r=e.map(u=>{var p,v;const d=(v=(p=t.implementations)==null?void 0:p.effects)==null?void 0:v[u];return d||A(`[zag-js] No implementation found for effect "${JSON.stringify(u)}"`),d}),o=[];for(const u of r){const d=u==null?void 0:u(_());d&&o.push(d)}return()=>o.forEach(u=>u==null?void 0:u())},j=n=>Y(n).find(e=>{let r=!e.guard;return Z(e.guard)?r=!!q(e.guard):M(e.guard)&&(r=e.guard(_())),r}),V=n=>{Q(t.computed,"[zag-js] No computed object found on machine");const e=t.computed[n];return e({context:m,event:l(),prop:E,refs:S,scope:s,computed:V})},R=J(()=>({defaultValue:t.initialState({prop:E}),onChange(n,e){var o,u,d,p;if(e){const v=C.current.get(e);v==null||v(),C.current.delete(e)}e&&N((o=t.states[e])==null?void 0:o.exit),N((u=L.current)==null?void 0:u.actions);const r=P((d=t.states[n])==null?void 0:d.effects);if(r&&C.current.set(n,r),e==="__init__"){N(t.entry);const v=P(t.effects);v&&C.current.set("__init__",v)}N((p=t.states[n])==null?void 0:p.entry)}})),z=c.useRef(void 0);H(()=>{queueMicrotask(()=>{const e=z.current??R.initial;R.invoke(e,"__init__")});const n=C.current;return()=>{z.current=R.ref.current,n.forEach(e=>e==null?void 0:e()),C.current=new Map,L.current=null,queueMicrotask(()=>{N(t.exit)})}},[]);const W=()=>"ref"in R?R.ref.current:R.get(),D=n=>{queueMicrotask(()=>{var p,v;g.current=f.current,f.current=n,i("send",n);let e=W();const r=((p=t.states[e].on)==null?void 0:p[n.type])??((v=t.on)==null?void 0:v[n.type]),o=j(r);if(!o)return;L.current=o;const u=o.target??e;i("transition",o);const d=u!==e;d?k.flushSync(()=>R.set(u)):o.reenter&&!d?R.invoke(e,e):N(o.actions??[])})};return($=t.watch)==null||$.call(t,_()),{state:b(),send:D,context:m,prop:E,scope:s,refs:S,computed:V,event:l()}}function U(t){const a=c.useRef(t);return a.current=t,a}function nt(t){const a=U(t);return function(i){return a.current[i]}}function B(t){queueMicrotask(()=>{k.flushSync(()=>t())})}var ft=h(t=>t);const[it,lt]=G({name:"EnvironmentContext",hookName:"useEnvironmentContext",providerName:"<EnvironmentProvider />",strict:!1,defaultValue:{getRootNode:()=>document,getDocument:()=>document,getWindow:()=>window}}),[dt,gt]=G({name:"LocaleContext",hookName:"useLocaleContext",providerName:"<LocaleProvider />",strict:!1,defaultValue:{dir:"ltr",locale:"en-US"}});export{lt as a,gt as b,ct as c,ft as n,at as u};
