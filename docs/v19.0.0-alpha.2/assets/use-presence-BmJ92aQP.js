import{c as d,p as N,s as g,q as v,r as p,t as E,d as f}from"./index-BCxMAfLs.js";import{c as P,u as y}from"./use-locale-context-Z4fgdY29.js";import{r as U}from"./index-D_CmzhJ4.js";import{u as A}from"./use-event-OCVb0O1l.js";const[C,k]=d({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"});function O(e,t){const{state:s,send:n,context:m}=e,a=s.matches("mounted","unmountSuspended");return{skip:!m.get("initial"),present:a,setNode(r){r&&n({type:"NODE.SET",node:r})},unmount(){n({type:"UNMOUNT"})}}}var S=N({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,action:t,prop:s}){e([()=>s("present")],()=>{t(["setInitial","syncPresence"])})},on:{"NODE.SET":{actions:["setNode","setStyles"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},invokeOnExitComplete:({prop:e})=>{var t;(t=e("onExitComplete"))==null||t()},setNode:({refs:e,event:t})=>{e.set("node",t.node)},setStyles:({refs:e,event:t})=>{e.set("styles",E(t.node))},syncPresence:({context:e,refs:t,send:s,prop:n})=>{const m=n("present");if(m)return s({type:"MOUNT",src:"presence.changed"});const a=t.get("node");if(!m&&(a==null?void 0:a.ownerDocument.visibilityState)==="hidden")return s({type:"UNMOUNT",src:"visibilitychange"});p(()=>{var i,o;const r=l(t.get("styles"));e.set("unmountAnimationName",r),r==="none"||r===e.get("prevAnimationName")||((i=t.get("styles"))==null?void 0:i.display)==="none"||((o=t.get("styles"))==null?void 0:o.animationDuration)==="0s"?s({type:"UNMOUNT",src:"presence.changed"}):s({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{p(()=>{e.set("prevAnimationName",l(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:s})=>{const n=t.get("node");if(!n)return;const m=i=>{var c,u;(((u=(c=i.composedPath)==null?void 0:c.call(i))==null?void 0:u[0])??i.target)===n&&e.set("prevAnimationName",l(t.get("styles")))},a=i=>{const o=l(t.get("styles"));f(i)===n&&o===e.get("unmountAnimationName")&&s({type:"UNMOUNT",src:"animationend"})};n.addEventListener("animationstart",m),n.addEventListener("animationcancel",a),n.addEventListener("animationend",a);const r=g(n,{animationFillMode:"forwards"});return()=>{n.removeEventListener("animationstart",m),n.removeEventListener("animationcancel",a),n.removeEventListener("animationend",a),v(()=>r())}}}}});function l(e){return(e==null?void 0:e.animationName)||"none"}P()(["onExitComplete","present","immediate"]);const D=(e={})=>{const{lazyMount:t,unmountOnExit:s,present:n,...m}=e,a=U.useRef(!1),r={...m,present:n,onExitComplete:A(e.onExitComplete)},i=y(S,r),o=O(i);o.present&&(a.current=!0);const c=!o.present&&!a.current&&t||s&&!o.present&&a.current,u=()=>({"data-state":n?"open":"closed",hidden:!o.present});return{ref:o.setNode,getPresenceProps:u,present:o.present,unmounted:c}};export{C as P,D as a,k as u};
