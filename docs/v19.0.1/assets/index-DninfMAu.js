var i=new WeakMap,h=new WeakMap,p={},m=0,b=t=>t&&(t.host||b(t.parentNode)),M=(t,n)=>n.map(a=>{if(t.contains(a))return a;const s=b(a);return s&&t.contains(s)?s:(console.error("[zag-js > ariaHidden] target",a,"in not contained inside",t,". Doing nothing"),null)}).filter(a=>!!a),W=t=>t.localName==="next-route-announcer"||t.localName==="script"||t.hasAttribute("aria-live")?!0:t.matches("[data-live-announcer]"),g=(t,n)=>{const{parentNode:a,markerName:s,controlAttribute:o}=n,c=M(a,Array.isArray(t)?t:[t]);p[s]||(p[s]=new WeakMap);const u=p[s],v=[],f=new Set,N=new Set(c),A=e=>{!e||f.has(e)||(f.add(e),A(e.parentNode))};c.forEach(A);const d=e=>{!e||N.has(e)||Array.prototype.forEach.call(e.children,r=>{if(f.has(r))d(r);else try{if(W(r))return;const k=r.getAttribute(o)==="true",w=(i.get(r)||0)+1,y=(u.get(r)||0)+1;i.set(r,w),u.set(r,y),v.push(r),w===1&&k&&h.set(r,!0),y===1&&r.setAttribute(s,""),k||r.setAttribute(o,"true")}catch(l){console.error("[zag-js > ariaHidden] cannot operate on ",r,l)}})};return d(a),f.clear(),m++,()=>{v.forEach(e=>{const r=i.get(e)-1,l=u.get(e)-1;i.set(e,r),u.set(e,l),r||(h.has(e)||e.removeAttribute(o),h.delete(e)),l||e.removeAttribute(s)}),m--,m||(i=new WeakMap,i=new WeakMap,h=new WeakMap,p={})}},H=t=>(Array.isArray(t)?t[0]:t).ownerDocument.body,E=(t,n=H(t),a="data-aria-hidden")=>{if(n)return g(t,{parentNode:n,markerName:a,controlAttribute:"aria-hidden"})},V=t=>{const n=requestAnimationFrame(()=>t());return()=>cancelAnimationFrame(n)};function S(t,n={}){const{defer:a=!0}=n,s=a?V:c=>c(),o=[];return o.push(s(()=>{const u=(typeof t=="function"?t():t).filter(Boolean);u.length!==0&&o.push(E(u))})),()=>{o.forEach(c=>c==null?void 0:c())}}export{S as a};
