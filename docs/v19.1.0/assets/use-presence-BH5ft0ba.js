import{c as N,H as v,y as g,I as E,r as p,J as f,d as P,K as y,L as U}from"./use-locale-context-DLC4Hyvy.js";import{r as A}from"./index-D_CmzhJ4.js";import{u as O}from"./use-event-OCVb0O1l.js";const[C,k]=N({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"});function M(e,t){const{state:a,send:n,context:m}=e,s=a.matches("mounted","unmountSuspended");return{skip:!m.get("initial"),present:s,setNode(i){i&&n({type:"NODE.SET",node:i})},unmount(){n({type:"UNMOUNT"})}}}var S=v({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,action:t,prop:a}){e([()=>a("present")],()=>{t(["setInitial","syncPresence"])})},on:{"NODE.SET":{actions:["setNode","setStyles"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},invokeOnExitComplete:({prop:e})=>{var t;(t=e("onExitComplete"))==null||t()},setNode:({refs:e,event:t})=>{e.set("node",t.node)},setStyles:({refs:e,event:t})=>{e.set("styles",f(t.node))},syncPresence:({context:e,refs:t,send:a,prop:n})=>{const m=n("present");if(m)return a({type:"MOUNT",src:"presence.changed"});const s=t.get("node");if(!m&&(s==null?void 0:s.ownerDocument.visibilityState)==="hidden")return a({type:"UNMOUNT",src:"visibilitychange"});p(()=>{var o,u;const i=l(t.get("styles"));e.set("unmountAnimationName",i),i==="none"||i===e.get("prevAnimationName")||((o=t.get("styles"))==null?void 0:o.display)==="none"||((u=t.get("styles"))==null?void 0:u.animationDuration)==="0s"?a({type:"UNMOUNT",src:"presence.changed"}):a({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{p(()=>{e.set("prevAnimationName",l(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:a})=>{const n=t.get("node");if(!n)return;const m=o=>{var r,c;(((c=(r=o.composedPath)==null?void 0:r.call(o))==null?void 0:c[0])??o.target)===n&&e.set("prevAnimationName",l(t.get("styles")))},s=o=>{const u=l(t.get("styles"));P(o)===n&&u===e.get("unmountAnimationName")&&a({type:"UNMOUNT",src:"animationend"})};n.addEventListener("animationstart",m),n.addEventListener("animationcancel",s),n.addEventListener("animationend",s);const i=g(n,{animationFillMode:"forwards"});return()=>{n.removeEventListener("animationstart",m),n.removeEventListener("animationcancel",s),n.removeEventListener("animationend",s),E(()=>i())}}}}});function l(e){return(e==null?void 0:e.animationName)||"none"}y()(["onExitComplete","present","immediate"]);const L=(e={})=>{const{lazyMount:t,unmountOnExit:a,present:n,skipAnimationOnMount:m=!1,...s}=e,i=A.useRef(!1),o={...s,present:n,onExitComplete:O(e.onExitComplete)},u=U(S,o),r=M(u);r.present&&(i.current=!0);const c=!r.present&&!i.current&&t||a&&!r.present&&i.current,d=()=>({"data-state":r.skip&&m?void 0:n?"open":"closed",hidden:!r.present});return{ref:r.setNode,getPresenceProps:d,present:r.present,unmounted:c}};export{C as P,L as a,k as u};
