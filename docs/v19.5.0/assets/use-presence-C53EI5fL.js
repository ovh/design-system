import{c as N,y as E,x as g,z as v,r as p,A as P,d as f,B as y,C as A}from"./use-locale-context-kHyebpMI.js";import{r as U}from"./index-jIWwRBLr.js";import{u as O}from"./use-event-c9j7vq_1.js";const[h,k]=N({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"});function C(e,t){const{state:a,send:n,context:m}=e,i=a.matches("mounted","unmountSuspended");return{skip:!m.get("initial"),present:i,setNode(o){o&&n({type:"NODE.SET",node:o})},unmount(){n({type:"UNMOUNT"})}}}var M=E({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["clearInitial","cleanupNode"],watch({track:e,prop:t,send:a}){e([()=>t("present")],()=>{a({type:"PRESENCE.CHANGED"})})},on:{"NODE.SET":{actions:["setupNode"]},"PRESENCE.CHANGED":{actions:["setInitial","syncPresence"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},clearInitial:({context:e})=>{e.set("initial",!1)},invokeOnExitComplete:({prop:e})=>{var t;(t=e("onExitComplete"))==null||t()},setupNode:({refs:e,event:t})=>{e.get("node")!==t.node&&(e.set("node",t.node),e.set("styles",P(t.node)))},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},syncPresence:({context:e,refs:t,send:a,prop:n})=>{const m=n("present");if(m)return a({type:"MOUNT",src:"presence.changed"});const i=t.get("node");if(!m&&(i==null?void 0:i.ownerDocument.visibilityState)==="hidden")return a({type:"UNMOUNT",src:"visibilitychange"});p(()=>{var s,u;const o=l(t.get("styles"));e.set("unmountAnimationName",o),o==="none"||o===e.get("prevAnimationName")||((s=t.get("styles"))==null?void 0:s.display)==="none"||((u=t.get("styles"))==null?void 0:u.animationDuration)==="0s"?a({type:"UNMOUNT",src:"presence.changed"}):a({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{p(()=>{e.set("prevAnimationName",l(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:a})=>{const n=t.get("node");if(!n)return;const m=s=>{var r,c;(((c=(r=s.composedPath)==null?void 0:r.call(s))==null?void 0:c[0])??s.target)===n&&e.set("prevAnimationName",l(t.get("styles")))},i=s=>{const u=l(t.get("styles"));f(s)===n&&u===e.get("unmountAnimationName")&&a({type:"UNMOUNT",src:"animationend"})};n.addEventListener("animationstart",m),n.addEventListener("animationcancel",i),n.addEventListener("animationend",i);const o=g(n,{animationFillMode:"forwards"});return()=>{n.removeEventListener("animationstart",m),n.removeEventListener("animationcancel",i),n.removeEventListener("animationend",i),v(()=>o())}}}}});function l(e){return(e==null?void 0:e.animationName)||"none"}y()(["onExitComplete","present","immediate"]);const D=(e={})=>{const{lazyMount:t,unmountOnExit:a,present:n,skipAnimationOnMount:m=!1,...i}=e,o=U.useRef(!1),s={...i,present:n,onExitComplete:O(e.onExitComplete)},u=A(M,s),r=C(u);r.present&&(o.current=!0);const c=!r.present&&!o.current&&t||a&&!r.present&&o.current,d=()=>({"data-state":r.skip&&m?void 0:n?"open":"closed",hidden:!r.present});return{ref:r.setNode,getPresenceProps:d,present:r.present,unmounted:c}};export{h as P,D as a,k as u};
