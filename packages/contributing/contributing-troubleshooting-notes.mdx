# Troubleshooting notes

<!-- TOC -->

* [Troubleshooting notes](#troubleshooting-notes)
  * [Yarn version](#yarn.lock-updates)
  * [dependency notes](#dependency-notes)
  * [Typescript notes](#typescript-notes)
    * [keep same typescript version](#keep-same-typescript-version)
    * [type error on dependencies](#type-error-on-dependencies)
    * [type error with wrong import in component.d.ts](#type-error-with-wrong-import-in-componentdts)
    * [Error TS2731 with keyof](#error-ts2731-with-keyof)

<!-- TOC -->

## yarn.lock updates

If yarn.lock file keeps updating itself on yarn install, though you did not change anything in a package, check your version of yarn and OVHcloud Design System project yarn version.
If your version of yarn is different from OVHcloud Design System project yarn version, please set same version than OVHcloud Design System project one to your version.

## Dependency notes

If you have an issue on different dependencies, try to display which package depends on what version like:

```bash
$ yarn why eslint
├─ ods@workspace:.
│  └─ eslint@npm:7.32.0 (via npm:^7.23.0)
│
└─ react-scripts@npm:3.4.4 [65fce]
   └─ eslint@npm:6.8.0 (via npm:^6.6.0)
```

## Typescript notes

Here are some use cases that you can encounter while developing with the current version of `ods`.

### keep same typescript version

You should use the same version of typescript in the different packages of ods.
Otherwise, you could have build error.

### type error on dependencies

If you encounter some build error about type errors inside the dependencies, it could mean that some type
between dependencies are incompatible.
You may disable type checking on dependencies in `tsconfig` with :
`"skipLibCheck": true,`

It is **not recommended**.

But the side effects are:

- build speed up
- not type checking of dependencies

### type error with wrong import in component.d.ts

if you have an error like :

```shell
../dist/types/components.d.ts:10:27 - error TS7016: Could not find a declaration file for module '../radio/src/components/osds-radio/osds-radio'. '/home/schevreu/IdeaProjects/ods/ods/packages/stencil/components/dist/radio/src/components/osds-radio/osds-radio.js' implicitly has an 'any' type.

10 import { OsdsRadio } from "../radio/src/components/osds-radio/osds-radio";
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
```

It may an error linked to the use of a stencil direct component import like :

```typescript
// import the radio from the radio-group via a direct import of the component
import { OsdsRadio } from '../osds-radio/osds-radio';
```

The solution is to avoid calling the component class :

```typescript
// use the core interface
import { OdsRadio } from '@ovhcloud/ods-core';
// declare a type that is a like below and use it instead of `OsdsRadio`
type OsdsRadioElement = HTMLElement & OdsRadio;
```

Another solution is to use `HTMLOsdsRadioElement` generated by stencil in file `component.d.ts` but this solution
involve a lot of refactoring.
So it is for a future major release.

### Error TS2731 with keyof

Using `'${name}'` with Typescript 4.7.4 triggers a typescript error like:

```
TS2731: Implicit conversion of a 'symbol' to a 'string' will fail at runtime. Consider wrapping this expression in 'String(...)'*
```

For more info:

- https://github.com/microsoft/TypeScript/issues/48848
- https://github.com/Microsoft/TypeScript/issues/12169
- https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-7.html#stricter-checks-with-template-string-expressions
- https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-9.html

We recommend using `string &` until the issue is closed:

```typescript
type MyType = string & keyof Component
```

### Error to sign commit with GPG key on WSL

You may have this error while commiting on WSL with GPG

```
error: gpg failed to sign the data
```

To fix that, you can add this to your bashrc file :

```bash
export GPG_TTY=$(tty)
```


### Stencil module not found after fresh install

If you have an error to build your project after just cloning it,
you can add this line to your bashrc to temporary fix it :

```bash
export PATH="$PATH:$HOME/<YOUR_ODS_PROJECT_FOLDER>/node_modules/.bin/"
```
This fix is just a workaround and a real fix may be found later.
This is not a sustainable solution since you'll need to update it if you change your ODS Project folder location.
