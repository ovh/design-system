import { Icon, ICON_NAME, Kbd } from '@ovhcloud/ods-react';
import { Meta, Source } from '@storybook/blocks';
import * as CartStories from './cart.stories';
import { Anatomy } from '../../../src/components/anatomy/Anatomy';
import { Banner } from '../../../src/components/banner/Banner';
import { Canvas } from '../../../src/components/canvas/Canvas';
import { BestPractices } from '../../../src/components/bestPractices/BestPractices';
import { Heading } from '../../../src/components/heading/Heading';
import { IdentityCard } from '../../../src/components/identityCard/IdentityCard';
import { StorybookLink } from '../../../src/components/storybookLink/StorybookLink';
import { REACT_COMPONENTS_TITLE, STORY } from '../../../src/constants/meta';

<Meta of={ CartStories } name="Documentation" tags={ ['new'] } />

<Banner of={ CartStories } />

<Canvas of={ CartStories.Overview } sourceState="none" />

<Heading label="Overview" level={ 2 } />

<IdentityCard aliases={ [] }
              figmaLink="https://www.figma.com/design/9jDDTcR4a9jPRFcdjawAlf/branch/9r0DZb1pFrkQnX1uAq9R6y/ODS---UI-Kit?node-id=15891-3153&t=vRk1EoUTDZKyd8fc-0"
              githubUrl="https://github.com/ovh/design-system/tree/master/packages/ods-react/src/components/cart"
              name="Cart"
              startingVersion={ 19 }>
  The **Cart** component provides a summary of the user’s current order.
  It displays the selected products, their associated options, pricing details, and the overall total before checkout.
</IdentityCard>

<Heading label="Usage" level={ 2 } />

Use the **Cart** component to:
- Display products and options added to the user’s order.
- Remove a product or an individual option from the order.
- Provide a clear breakdown of pricing, including promotions and included items.
- Show the total amount and allow users to continue their order.

<Heading label="Dos & Don'ts" level={ 3 } />

<BestPractices
  donts={[
    '- Don’t use the Cart to display unrelated content or marketing messages',
    '- Don’t include vague product or option labels since they should clearly identify the item',
    '- Don’t overload the Cart with too many optional lines, which can make it hard to scan',
    '- Don’t mix different types of content (e.g., recommendations) with the Cart items ?',
  ]}
  dos={[
    '- Use Cart sections (product header, options) to group related information clearly',
    '- Use expand/collapse only for optional details that help users review their order without cluttering the interface',
    '- Use promotions and included option labels to communicate value clearly',
    '- Display footer lines for additional contextual information such as VAT, shipping, or billing details',
    '- Use remove icon buttons consistently for products and options to allow quick corrections',
  ]}
/>

<Heading label="Best Practices in Context" level={ 3 } />

<Anatomy src="components/cart/anatomy.png" />

1. **Cart**
2. **Product header**
3. **Product option list**
4. **Footer**

<Heading label="Placement" level={ 2 } />

The **Cart** component is typically placed:
- On the right side of the page on desktop layouts.
- As a bottom sheet on mobile devices.

It should remain visible and easily accessible throughout the ordering flow.

<Heading label="Behavior" level={ 2 } />

<Heading label="Desktop" level={ 3 } />

- The **Cart** is open and fully expanded by default.
- Product can be expanded or collapsed to show or hide its options.
- The **Cart** content is vertically scrollable when it exceeds the available space.
- Clicking the product remove icon button removes the entire product and all associated options.
- Clicking an option remove icon button removes only that option and updates the product price and **Cart** total.

<Heading label="Mobile" level={ 3 } />

- The **Cart** is closed by default.
- Only the handle and the **Cart** total area are visible while closed.
- Users can swipe the handle to open the **Cart** and review order details.
- While open, the **Cart** content is scrollable.
- Users can swipe the handle again to close the **Cart**.
- Remove icon buttons remain accessible within the **Cart** when open and expanded.

<Heading label="Empty Cart" level={ 3 } />

When no product is added:
- Display a message indicating that the cart is empty.
- Display a disabled "Continue my order" **Button**.
- When the last product is removed, the **Cart** immediately transitions to the empty state.

<Heading label="Navigation" level={ 2 } />

<Heading label="Focus Management" level={ 3 } />

All interactive elements inside the **Cart** (expand/collapse controls, buttons) can receive keyboard focus.

The **Cart** container itself does not receive focus.

When a product header expand/collapse control is activated, the focus remains on the control and the associated product options are revealed or hidden without moving focus.

When the **Cart** is closed on mobile, only the **Cart** handle and visible interactive elements can receive focus.

When the **Cart** is open on mobile, all interactive elements inside the **Cart** become focusable.

The disabled **Button** cannot receive focus.

<Heading label="General Keyboard Shortcuts" level={ 3 } />

Pressing <Kbd>Tab</Kbd> or <Kbd>Shift</Kbd> + <Kbd>Tab</Kbd> moves focus sequentially through all interactive elements inside the **Cart**.

Pressing <Kbd>Enter</Kbd> or <Kbd>Space</Kbd> activates the currently focused element. This can:
- Expand or collapse a product to show or hide its options.
- Remove the associated product or option.
- Trigger the **Cart** action button.

Pressing <Kbd>Escape</Kbd> collapses the **Cart** when it is expanded on mobile and returns focus to the **Cart** handle.

<Heading label="Accessibility" level={ 2 } />

<Heading label="Announce product and option updates" level={ 3 } />

When a product or option is added, removed, or when the total price changes, screen readers are not automatically informed.

To ensure users receive feedback, use a live region in your DOM and update its text content when the `Cart` changes.

<Source code={`
const liveRef = useRef<HTMLDivElement>(null);

function updateLiveRegion() {
  if (liveRef.current) {
    liveRef.current.textContent = 'Product "My product" has been added to your cart. Total is now xx.xx€.';
  }
}

return (
  <div
    ref={ liveRef }
    role="status" />
`}
        dark="true"
        language="tsx" />

<Icon name={ ICON_NAME.circleCheck }
      style={{ color: 'var(--ods-color-success-500)' }} /> Screen readers will inform users of product additions, removals, and total updates through the live region.
