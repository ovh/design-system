import { Canvas, Meta } from '@storybook/blocks';
import { ODS_ICON_NAME } from '@ovhcloud/ods-components';
import { OdsIcon } from '@ovhcloud/ods-components/react';
import * as SpinnerStories from './spinner.stories';
import { Banner } from '../../../src/components/banner/Banner';
import { BestPractices } from '../../../src/components/bestPractices/BestPractices';
import { Heading } from '../../../src/components/heading/Heading';
import { IdentityCard } from '../../../src/components/identityCard/IdentityCard';
import { StorybookLink } from '../../../src/components/storybookLink/StorybookLink';
import { ATOMIC_TYPE } from '../../../src/constants/atomicDesign';
import { ODS_COMPONENTS_TITLE, STORY } from '../../../src/constants/meta';

<Meta of={ SpinnerStories } name="Documentation" />

<Banner of={ SpinnerStories } />

_A visual indicator that a process is happening in the background but the interface is not yet ready for interaction._

<Canvas of={ SpinnerStories.Overview } sourceState="none" />

<Heading label="Overview" level={ 2 } />

<IdentityCard aliases={ ['Loading', 'Spin', 'Circular Progress'] }
              atomicType={ ATOMIC_TYPE.quark }
              figmaLink="https://www.figma.com/design/9jDDTcR4a9jPRFcdjawAlf/ODS---UI-Kit?node-id=52-10340"
              githubUrl="https://github.com/ovh/design-system/tree/master/packages/ods/src/components/spinner"
              name="Spinner"
              relatedComponents={ [] }>
  A visual indicator that **a process is happening in the background** but the interface is not yet ready for
  interaction.
</IdentityCard>

<Heading label="Anatomy" level={ 2 } />

![Component anatomy](components/spinner/anatomy.png "Component anatomy")

1. **Main content**: the **Spinner** itself.

<Heading label="Usage" level={ 2 } />

**Spinner** component is used as a fallback when complex content is loading in the background.

When using a **Spinner** directly over content, we recommend applying an opacity to the content container to de-emphasize the content and increase the visibility of the **Spinner**.

<Heading label="Dos & Don'ts" level={ 3 } />

<BestPractices
  donts={[
    '- Use multiple Spinners on the same page, prefer using a single Spinner on an overlay',
    <span>- Use Spinner for text-only loading. Use <StorybookLink kind={ ODS_COMPONENTS_TITLE.skeleton } label="Skeleton" story={ STORY.documentation } /> component instead</span>,
  ]}
  dos={[
    '- Use Spinner when the loading wait time is expected to be longer than three seconds',
  ]}
/>

<Heading label="Placement" level={ 2 } />

**Spinner can be placed where needed**, whether it's centered on an overlay or specific container/content in the page.

**Spinner** can widen to match its container.

<Heading label="Behavior" level={ 2 } />

The **Spinner** component has a spinning animation to show to the user that the background process is moving on.

<Heading label="Variation" level={ 2 } />

N/A

<Heading label="Accessibility" level={ 2 } />

The **Spinner** component does not automatically provide enough context for assistive technologies.
To ensure accessibility, additional attributes must be applied to the container that holds the loading content.

<Heading label="Best practices" level={ 3 } />

<Heading label="Indicating loading state with aria-busy and aria-live" level={ 4 } />

The **Spinner** itself does not convey the loading state. This responsibility falls on the container where content is being loaded.

Example of wrapping the **Spinner** in a loading container:

<Canvas of={ SpinnerStories.AvailabilityContainer } sourceState="shown" />

What happens ?

- `aria-busy="true"` informs assistive technologies that content is being updated.
- `aria-live= "polite"` ensures that the loading message is announced when necessary without interrupting the user.

<OdsIcon ariaHidden
         name={ ODS_ICON_NAME.circleCheck }
         style={{ color: 'var(--ods-color-success-500)' }} /> This approach ensures that users with assistive technologies understand when loading starts and ends.

<OdsIcon ariaHidden
         name={ ODS_ICON_NAME.circleInfo }
         style={{ color: 'var(--ods-color-information-500)' }} /> Once the content is loaded, `aria-busy` should be set to false.

<Heading label="Linking the Spinner to a loading description" level={ 4 } />

If the **Spinner** is associated with a specific loading action, it should be explicitly labeled using `aria-label` or `aria-labelledby`.

Example of using `aria-label` for context:

<Canvas of={ SpinnerStories.AvailabilityAriaLabel } sourceState="shown" />

<OdsIcon ariaHidden
         name={ ODS_ICON_NAME.circleCheck }
         style={{ color: 'var(--ods-color-success-500)' }} /> Screen readers will announce "Loading user profile, <...>, progress indicator".

Example of using `aria-labelledby` for context:

<Canvas of={ SpinnerStories.AvailabilityAriaLabelledby } sourceState="shown" />

<OdsIcon ariaHidden
         name={ ODS_ICON_NAME.circleCheck }
         style={{ color: 'var(--ods-color-success-500)' }} /> Screen readers will announce "Loading user profile, <...>, progress indicator".
